<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Adwall</title>
</head>
<body>
<script>
const SHARED_KEY = "place_your_key_here"
const LOCAL_URL = "http://localhost:4173"

// Get sessionId from URL or redirect to /init
const params = new URLSearchParams(window.location.search)
const sessionId = params.get('sid')

if (!sessionId) {
  // Redirect to /init to get session
  window.location.href = `${LOCAL_URL}/init?redirect=${encodeURIComponent(window.location.href)}`
} else {
  // We have sessionId, show adwall
  let minTime = params.get('t') || 15000
  minTime = parseInt(minTime)

  async function sha256(v) {
    const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(v))
    return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2, "0")).join("")
  }

  const startTime = Date.now()
  const btn = document.createElement('button')
  btn.style.cssText = 'padding:10px 20px;font-size:14px;cursor:pointer'
  btn.disabled = true

  document.body.innerHTML = '<div style="padding:40px;text-align:center;"><h1>Adwall</h1><p>Complete to continue</p></div>'
  document.body.appendChild(btn)

  const tick = () => {
    const elapsed = Date.now() - startTime
    const remaining = Math.max(0, minTime - elapsed)
    btn.textContent = remaining > 0 ? `Wait ${Math.ceil(remaining / 1000)}s` : 'Continue'
    btn.disabled = remaining > 0
    if (remaining > 0) requestAnimationFrame(tick)
  }

  tick()

  btn.onclick = () => {
    window.location.href = `${LOCAL_URL}/link?sid=${sessionId}`
  }
}
</script>
</body>
</html>


